# **2.5 지연 시간(Latency)**

지연 시간(Latency)이란 **사용자의 요청이 시스템에 도달해서 처리된 뒤 응답이 돌아오기까지 걸리는 전체 시간**을 의미한다.  
분산 환경에서는 네트워크, 복제 방식, 스토리지, 장애 허용 전략 등에 따라 지연 시간이 크게 달라진다.

---

## **1. 지연 시간의 구성 요소**

1) **네트워크 지연 (Network latency)**  
- 리전 간 거리, 라우팅 경로, 네트워크 품질에 따라 결정됨  
- 글로벌 서비스에서 가장 결정적인 요소

2) **처리 지연 (Processing latency)**  
- 애플리케이션 로직, 스레드 처리, 큐 대기 시간

3) **스토리지 지연 (Storage I/O latency)**  
- DB 쿼리, 디스크 I/O, 캐시 미스(Cache miss)

4) **복제 지연 (Replication latency)**  
- 동기 복제 vs 비동기 복제 차이에 따라 달라짐  
- 멀티 노드 데이터 일관성 유지에 따른 비용

---

# **2. 지연 시간과 Trade-off (핵심)**

지연 시간은 단독으로 존재하지 않고  
**일관성(Consistency), 가용성(Availability), 내구성(Durability)**  
같은 속성과 항상 “트레이드오프” 관계를 가진다.

---

## **2-1. 지연 시간 ↔ 일관성 (Consistency)**

### **강한 일관성을 선택하면 → 지연 시간 증가**
- 동기 복제 필요  
- 모든 노드가 쓰기 확인 후 응답  
- → 글로벌 환경에서는 Round-trip이 길어짐

### **최종 일관성을 선택하면 → 지연 시간 감소**
- 비동기 복제로 write를 빠르게 처리  
- 여러 리전에 분산 처리 가능  
- → 데이터는 잠시 불일치할 수 있음

**핵심:**  
결제·예약 서비스는 지연을 감수하고 Strong Consistency  
SNS·로그는 최신성보다 속도가 중요해 Eventual Consistency

---

## **2-2. 지연 시간 ↔ 가용성 (Availability)**

### 지연을 줄이기 위해 가용성을 높이는 전략
- 여러 리전에 Active-Active 배포
- 가까운 리전으로 트래픽 라우팅(Geo-routing)
- 캐시 도입

### 반대로, 가용성을 높이면 지연이 생기기도 함
- 장애 감지 → Failover 과정에서 짧은 지연 발생
- 트래픽 분산 → 특정 노드로 우회하면서 지연 증가

---

## **2-3. 지연 시간 ↔ 내구성(Durability)**

### 강한 내구성 = “디스크에 안전하게 기록되기 전에는 응답하지 않음”
- 로그 플러시(sync write)  
- fsync 수행  
- → I/O 비용으로 인해 latency 증가

예: PostgreSQL, Kafka acks=all + min.insync.replicas

### 내구성 약화 = 지연 시간 감소
- 메모리에 먼저 기록 후 백그라운드 flush  
- 데이터 손실 위험 증가

---

# **3. 지연 시간 최적화 전략**

### **1) 캐싱**
- Redis, CDN, 애플리케이션 캐시
- 읽기 요청 latency를 크게 낮춤

### **2) 로드 밸런싱**
- 가장 가까운 리전/노드로 요청을 분배

### **3) 비동기 처리**
- 큐(Kafka, SQS)를 활용해 사용자 응답을 빠르게 반환

### **4) 데이터 모델링 최적화**
- 인덱스 최적화, JOIN 최소화, 정규화/비정규화 전략


# **2.8 장애 허용성(Fault Tolerance)**

장애 허용성(Fault Tolerance)이란  
**시스템 일부가 고장 나더라도 전체 서비스는 계속 정상적으로 동작하는 능력**을 의미한다.

즉 “노드 하나 죽어도 서비스가 중단되지 않는 시스템”이 장애 허용 시스템이다.

---

# **1. 장애 허용성이 필요한 이유**

분산 시스템에서는 다음과 같은 장애가 매우 흔하다.

- 서버 장애(프로세스 다운, 메모리 부족)
- 네트워크 단절(파티션)
- 디스크 장애
- 레플리카 지연 및 불일치
- 데이터센터(Zone/Region) 장애

이 중 **하나라도** 발생할 수 있기 때문에  
“한 노드의 장애가 전체 장애로 이어지지 않는 구조”가 필수다.

---

# **2. 장애 허용성을 구성하는 핵심 요소**

## **1) 복제(Replication)**
장애 허용성 구현의 핵심은 **데이터 복제**다.

- 동일한 데이터/서비스를 여러 노드에 분산해 두어  
  하나가 죽어도 다른 노드가 역할을 이어받는다.

### 예시
- DB: Primary–Replica 구조  
- Kafka: ISR(In-Sync Replica) 기반 리더-팔로워 구조  
- Redis: Master-Slave + Sentinel  

---

## **2) 장애 감지(Failure Detection)**

장애 허용 시스템은 다음을 통해 *“죽은 노드”* 를 빠르게 감지한다.

- Heartbeat (주기적 생존 신호)
- Health check
- Timeout 기반 Failure Detector

### 중요한 포인트
장애 감지 속도가 느리면 **Failover가 늦어져 전체 지연이 증가**한다.

---

## **3) 장애 전환(Failover)**

장애가 감지되면  
**정상 노드를 자동으로 리더(Primary)로 승격**시키는 과정이다.

- 자동 전환(Auto-failover)
- 수동 전환(Manual failover)

Failover 전략이 안정적이지 않으면
**Split-brain, 데이터 유실, 롤백** 등이 발생할 수 있다.

---

## **4) 중복성(Redundancy)**

장애 허용성은 결국 “여러 개 준비해둔다”는 의미다.

- 서버 중복
- 네트워크 경로 중복
- 스토리지 중복
- 리전/Zone 중복(AZ 수준 Replication)

이 중 하나라도 빠지면 장애 허용성이 약해진다.

---

# **3. 장애 허용성과 Trade-off**

장애 허용성은 **일관성·지연 시간·복잡성·비용**과 항상 트레이드오프 관계를 가진다.

---

## **3-1. 장애 허용성 ↑ → 일관성 ↓ (CAP 이론)**

- 네트워크 파티션 상황에서  
  *서비스가 멈추지 않게 하려면* → 다른 노드에서 계속 처리해야 함  
- 이때 강한 일관성(C) 유지가 불가능해짐

→ **가용성(A)**을 얻는 대신 **일관성(C)을 일부 포기**

예:  
- DynamoDB, Cassandra, Kafka `acks=1` 운영

---

## **3-2. 장애 허용성 ↑ → 지연 시간 ↑**

- 여러 노드에서 복제·동기화 필요  
- 장애 감지 및 Failover 준비 필요  
- 네트워크 왕복 비용 증가

→ 장애 허용성을 극대화할수록 응답 시간은 길어진다.

예:  
- Kafka `acks=all`  
- DB Sync Replication  
- Multi-AZ Sync Storage

---

## **3-3. 장애 허용성 ↑ → 비용 증가**

- 서버를 여러 대 유지해야 함  
- Multi-AZ, Cross-Region 비용 증가  
- 고가의 네트워크 구성 필요

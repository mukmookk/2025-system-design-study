# 2.4 파티션 허용성(Partition Tolerance)

파티션 허용성은 **네트워크 단절(Partition)** 상황에서도 시스템이 가능한 한 정상적으로 동작할 수 있는 능력을 의미한다.  
분산 시스템은 물리적으로 여러 노드와 네트워크로 구성되기 때문에,  
네트워크 파티션은 “예외”가 아니라 “언젠가 반드시 발생하는 이벤트”로 취급된다.

따라서 분산 시스템에서는 **파티션 허용성(P)**을 반드시 확보해야 하며, 이것이 CAP 이론의 기본 전제이다.

---

## 1. 네트워크 파티션(Network Partition)

### 정의
- 여러 노드가 동일한 네트워크로 연결되어 있어야 하는데,  
  **네트워크 장애로 인해 두 개 이상의 그룹으로 나뉘어 서로 통신이 불가능해지는 상황**

### 발생 원인
- 라우터/스위치 장애
- Region 또는 AZ 간 링크 장애
- 특정 서버 Rack 전체의 네트워크 문제
- 방화벽/라우팅 설정 오류
- Kubernetes 노드 간 네트워크 단절

### 파티션 발생 시 특징
- 서로 다른 노드 그룹이 **각자 독립적인 세계**처럼 동작함
- 데이터 동기화가 불가능함
- “읽기/쓰기” 연산이 서로 다른 노드에서 다르게 처리되어 **일관성 문제** 발생 가능
- 일부 노드 그룹만 정상 응답할 수도 있음

### 실무 예시
- 서울 리전 ↔ 부산 리전 간 네트워크 끊김  
- Kafka 클러스터에서 일부 브로커와 컨트롤러 간 통신 단절  
- Redis Sentinel이 마스터를 못 찾고 오동작하는 상황  
- Kubernetes 클러스터가 두 그룹으로 나뉘어 서로를 unreachable로 판단하는 상황

결론적으로, **네트워크 파티션은 분산 환경에서 피할 수 없는 문제**다.

---

## 2. 파티션 허용성(Partition Tolerance)

### 정의
- 네트워크 파티션이 발생해도 시스템이 가능한 한 정상적으로 동작하도록 설계하는 것  
- 즉, 일부 노드 간 통신이 불가능해도 전체 시스템이 “멈추지 않도록” 하는 능력

### 왜 항상 유지해야 하는가?
- 분산 시스템은 물리적·지리적 제약 때문에 **언제든지 네트워크 장애가 발생할 수 있다**
- 따라서 파티션 허용성을 제거하면 분산 시스템 자체가 성립할 수 없음
- CAP 이론에서도 “P는 반드시 만족해야 하며, C(일관성) 또는 A(가용성) 중 하나만 선택 가능”하다고 설명한다

### 파티션 허용성을 위한 설계 방식

#### 1) Failover / Leader Election
- ZooKeeper, Etcd, Raft, Kafka 등이 사용하는 방식  
- 장애가 발생하면 새로운 리더를 선출하여 서비스 지속

#### 2) Quorum 기반 작업
- Majority(과반수) 노드가 동의하면 쓰기/읽기 성공  
- Cassandra, DynamoDB 등이 사용  
- 파티션 상황에서도 가능한 한 정확하게 유지

#### 3) 복제본(Replica)을 여러 Region/AZ에 배치
- 한 그룹이 장애여도 다른 그룹이 정상 운영

#### 4) 네트워크 단절 시에도 각 Partition이 일정 범위의 요청을 처리하도록 허용
- 최종 일관성이 필요한 위치에서 흔히 사용

#### 5) Conflict Resolution 전략 사용
- 파티션 해소 후 노드 간 데이터 충돌 해결  
  (Last-Write-Wins, Vector Clock 등)

---

## 3. 파티션 허용성의 장점

- 네트워크 장애 환경에서도 서비스가 완전히 멈추지 않음
- 글로벌 서비스에서 필수적인 안정성 확보 가능
- 대규모 분산 시스템에서 운영 리스크 감소

---

## 4. 파티션 허용성의 단점

- 파티션 상황에서 일관성 또는 가용성 중 하나를 포기해야 함 (CAP Trade-off)
- 충돌 해결, 데이터 복구 비용 증가
- 일부 노드에서 “옛 데이터”를 읽을 가능성 존재

---

## 5. 파티션 허용성 선택 기준 (실무)

### 1) 글로벌 트래픽이 많은가?
- Yes → 파티션 허용성 필수 (Region 간 네트워크는 언제나 불안정)

### 2) 다중 AZ, 다중 Region 아키텍처인가?
- 그렇다면 P를 유지하는 것이 기본 전제

### 3) 파티션 상황에서 어떤 것을 우선할 것인가?
- 정확도 > 가용성 → C 선택 → 강한 일관성  
- 가용성 > 정확도 → A 선택 → 최종 일관성

---

1. “파티션 허용성은 네트워크 단절이 발생해도 시스템이 완전히 중단되지 않도록 하는 성질입니다.”
2. “분산 시스템에서는 파티션이 반드시 발생할 수 있기 때문에, CAP 이론의 전제처럼 파티션 허용성(P)은 항상 유지해야 합니다.”
3. “파티션이 발생하면 일관성(C) 또는 가용성(A) 중 하나를 희생해야 하고, 이는 비즈니스 요구사항에 따라 결정합니다.”
4. “Cassandra, DynamoDB, Kafka 등 대규모 분산 시스템들은 파티션 상황에서도 동작하도록 Quorum, Leader Election, Replication을 이용합니다.”

# **3.4 FLP 불가능성 정리 (Fischer–Lynch–Paterson Impossibility)**

FLP는 분산 시스템 이론에서 가장 중요한 결론 중 하나이다.  
FLP 정리의 핵심은 아래 한 문장으로 요약된다.

> **완전 비동기 환경에서  
> 단 1개의 노드 장애(Crash Fault)가 존재하기만 해도  
> 어떤 결정적(Deterministic) 합의 알고리즘도  
> “항상 종료(Termination)”를 보장할 수 없다.**

즉, **안전성(Safety)**과 **종료성(Termination)**을 완전 비동기 환경에서는 동시에 만족시킬 수 없다는 뜻이다.

이 정리는 Paxos, Raft, KRaft, PBFT, Blockchain 등이  
왜 Timeout·Heartbeat·Randomness·Leader 기반 구조를 사용하는지  
“이론적 이유”를 제공한다.

---

# **1. FLP가 불가능을 주장하는 3가지 전제 조건**

FLP의 “불가능”은 매우 극단적인 가정 3개가 **모두 동시에** 성립할 때만 적용된다.

## **1.1 완전 비동기 모델 (Fully Asynchronous Model)**

### 정의
- 메시지가 언제 도착할지 전혀 알 수 없음  
- 지연 시간(Delay), 순서(Order), 최대 시간(bound) 없음  
- Timeout, Heartbeat, 시계(clock) 존재 불가  

즉, A는 B에게 보낸 메시지가  
“늦는 건지, 사라진 건지, 상대가 죽은 건지”  
**영원히 판단할 수 없다.**

### 왜 이 가정을 두는가?
합의 종료(Termination)가 불가능하다는 것을 증명하려면  
노드가 “상대 노드의 상태를 절대 알 수 없는 환경”이 필요하기 때문이다.

이 조건 하나만으로도  
“언제 결정해야 하는지 판단할 수 없다”는 문제가 생긴다.

### 실무와의 차이
실제 시스템은 완전 비동기가 아니라 **부분 동기(Partial Synchrony)**다.

**Timeout, Heartbeat, RTO, Lease** 같은 기법이 있기 때문에  
“언젠가는 메시지가 온다”는 약한 가정을 둔다.

#### 실무 예시
- Raft Election Timeout (150–300ms random)  
- Paxos Retry Timeout  
- Kafka KRaft Heartbeat  
- TCP Retransmission Timeout  
- Kubernetes Node Heartbeat (10초)

→ 완전 비동기가 아니므로 FLP의 첫 조건은 깨진다.

---

## **1.2 Crash Fault 존재 가능성**

### 정의
노드는 언제든 예고 없이 다음을 겪을 수 있다.
- 완전히 멈춤(Crash)
- 메시지를 보내지 않음
- 복구될 수도 / 영원히 죽을 수도 있음

### 왜 이 가정을 두는가?
FLP는 “단 하나의 crash만 있어도” 종료 보장이 불가능하다는 극단적 사례를 만들기 위해서다.  
Byzantine 장애가 아니라 **가장 단순한 Crash Fault만으로도**  
합의 종료가 불가능함을 보여주는 것이 핵심이다.

### 실무와의 차이
실제 네트워크는 “언젠가는 안정된다”는 가정을 둔다.  
(= partial synchrony)

#### 실무 예시
- AWS AZ 한두 개 죽어도 나머지 AZ에서 합의 계속  
- Raft: Leader 죽으면 Timeout 후 즉시 선거  
- Kafka: ISR에서 장애 Broker를 제외하고 다시 구성  
- Zookeeper: 과반수 살아 있으면 합의 진행

→ 현실에서는 Crash가 있어도 결국 시스템이 수렴한다.

---

## **1.3 결정적(Deterministic) 알고리즘**

### 정의
- 동일 입력 → 항상 동일한 출력  
- Randomness, Backoff, PoW 없음  
- nondeterministic 동작 없음  

### 왜 이 가정을 두는가?
FLP의 목표는 이 질문에 답하는 것이다:

> “완전히 deterministic한 알고리즘이  
>  crash + 비동기 네트워크에서 합의를 끝낼 수 있는가?”

FLP는 “아니다”라고 증명한다.

Randomness를 허용하면  
determinism이 깨지고 FLP의 수학적 전제 자체가 성립하지 않는다.

### 실무와의 차이
현실 시스템은 모두 **Randomness를 사용하여 FLP 조건을 깨뜨린다.**

#### 실무 예시
- Raft: Random Election Timeout  
- Bitcoin PoW: 무작위 해시 경쟁  
- PBFT: View-change 시 randomness 포함  
- K8s Leader Election: Lease + Random backoff  
- gRPC / HTTP retry에도 exponential backoff 랜덤 요소 포함

→ Randomness는 FLP 회피의 대표적인 전략이다.

---

# **2. FLP가 말하는 불가능 = “안전성과 종료성을 동시에 만족시키지 못한다”**

비동기 + Crash + Deterministic  
3가지 조건이 동시에 존재하면 다음이 성립한다:

- 안전하게 하려면 → 영원히 기다릴 수 있다 (termination 불가)  
- 빨리 끝내려 하면 → 잘못된 결정을 내릴 위험 있음 (safety 깨짐)

즉, 이 환경에서는  
**안전성과 종료성을 동시에 만족하는 알고리즘은 존재할 수 없다.**

---

# **3. 그럼 Paxos, Raft, KRaft, PBFT는 어떻게 동작하는가? (FLP 우회)**

| FLP 조건 | 실무 시스템에서 깨는 방법 | 실제 예시 |
|----------|-----------------------------|-----------|
| 완전 비동기 | Timeout / Heartbeat → 부분 동기 | Raft, Paxos, KRaft |
| Crash Fault | Failover, Leader 선출 | Raft Leader Election |
| Deterministic | Random Timeout, PoW | Bitcoin, Raft |

즉, **실제 시스템은 FLP의 3가지 조건을 일부러 깨고 동작한다.**

---

# **4. 왜 FLP 이론이 필요한가? (실무와 동떨어져 있는 것처럼 보이지만)**

FLP는 이론이지만 아래 네 가지 이유 때문에 **실무적으로 매우 중요**하다.

---

## **4.1 합의 알고리즘이 왜 Timeout·Heartbeat·Leader를 사용하는지 설명해 준다**
왜 Raft, Paxos, KRaft는 모두 다음을 쓸까?

- Heartbeat  
- Randomized Election Timeout  
- Leader 기반 구조  
- Retransmission  
- Lease  

→ 전부 FLP의 제약을 피하기 위한 설계다.

---

## **4.2 “절대 발생할 수 없는 완벽한 비동기 시스템”을 상정하여 최악의 경우를 이론화한다**

분산 시스템에서 가장 무서운 말은:

> “메시지가 온다고 장담할 수 있나요?”

FLP는 이 본질적인 불확실성을  
수학적으로 정확히 설명해준다.

---

## **4.3 이론적 불가능성을 알아야 현실적인 시스템을 설계할 수 있다**

예: Raft Leader 선출에서 Timeout이 필수라는 사실  
→ FLP를 모르면 "왜 Timeout이 필요하지?"가 설명이 안 된다.

예: Paxos가 복잡하게 보이지만 Safety는 절대 깨지지 않는 이유  
→ FLP 구조를 우회한 설계이기 때문

예: Kafka의 unclean.leader.election 논쟁  
→ 안전성(Safety) vs 종료성(Availability)의 문제  
→ FLP와 동일한 Trade-off 구조

---

## **4.4 CAP 이론과 함께 분산 시스템의 근본 한계를 정의한다**

FLP = Safety ↔ Termination 불가능  
CAP = Consistency ↔ Availability 불가능

둘은 서로 다른 관점에서  
“분산 시스템의 근본 한계”를 설명한다.

실제 분산 시스템 설계에서 둘은 항상 함께 등장한다.

---

# **5. 결론**

**“FLP는 실무에서 실제 문제가 생긴다는 뜻이 아니라,  
합의 알고리즘이 Timeout·Randomness·Leader 기반 구조를 가지는 이유를 명확히 설명하는 이론적 기반이다.”**

즉:

- 완전 비동기에서는 합의 종료 보장 불가능  
- 실제 시스템은 부분 동기 모델로 동작  
- Randomness와 Leader 구조로 FLP를 우회  

이 세 가지를 이해하면  
Raft·Paxos·KRaft·PBFT 설계를 자연스럽게 이해할 수 있다.
## HBase와 DynamoDB의 일관성 모델 비교

HBase와 DynamoDB는 모두 대규모 분산 환경을 전제로 설계된 데이터베이스이지만,  
일관성을 바라보는 관점과 이를 구현하는 방식에는 명확한 차이가 있다.

이 절에서는 두 시스템이  
어떤 수준의 일관성을 기본으로 제공하며,  
그 선택이 어떤 설계적 의도를 반영하는지 비교한다.

---

### 1. 일관성 모델의 기본 철학

두 시스템은 CAP 이론의 동일한 제약 조건 아래에서  
서로 다른 우선순위를 선택했다.

- HBase  
  - Row 단위 강한 일관성을 핵심으로 설계
  - 클러스터 전체 상태는 최종 일관성으로 관리

- DynamoDB  
  - 최종 일관성을 기본 모델로 채택
  - 가용성과 확장성을 최우선으로 고려

즉,  
HBase는 **쓰기와 읽기의 정확성**을,  
DynamoDB는 **항상 응답하는 시스템**을 우선한다.

---

### 2. HBase의 일관성 보장 방식

#### Row 단위 강한 일관성

- 하나의 Row Key는 단일 RegionServer가 전담
- 동일 Row에 대한 읽기와 쓰기는 직렬화되어 처리
- 쓰기 완료 후 읽기는 항상 최신 데이터를 반환

이로 인해 HBase는  
단일 Row 범위 내에서는 Strong Consistency를 제공한다.

---

#### 시스템 관점의 최종 일관성

다만, 클러스터 전체를 보면  
다음 요소들은 최종 일관성 모델을 따른다.

- Region 이동 및 재할당
- META 테이블 정보 전파
- 장애 복구 후 상태 동기화

아키텍처 차원에서  
상태 변화는 점진적으로 전파되며,  
결과적으로 일관된 상태로 수렴한다.

---

#### WAL과 비동기적 스토리지 반영

- 쓰기는 WAL에 먼저 기록
- MemStore에 반영 후 클라이언트에 응답
- HFile로의 flush와 compaction은 비동기 수행

이 구조는  
즉각적인 글로벌 일관성보다  
장애 허용성과 성능을 선택한 결과이다.

---

### 3. DynamoDB의 일관성 보장 방식

#### 기본 모델: 최종 일관성

DynamoDB의 기본 읽기 동작은  
최종 일관성(Eventual Consistency)이다.

- 쓰기 직후 읽기 시 이전 값 반환 가능
- 시간이 지나면 모든 레플리카가 동일한 값으로 수렴
- 읽기 성능과 가용성이 우선됨

이 모델은  
대규모 트래픽 환경에서도 안정적인 응답을 보장한다.

---

#### 선택적 강한 일관성 읽기

DynamoDB는 필요에 따라  
강한 일관성 읽기를 선택적으로 제공한다.

- 동일 리전에 한해 제공
- 최신 쓰기 결과를 항상 반환
- 처리 비용(RCU)과 지연 시간 증가

즉, 일관성은 기본값이 아니라  
**비용을 지불하고 선택하는 옵션**이다.

---

#### 쓰기 충돌과 수렴 방식

DynamoDB는 동시에 발생한 쓰기 충돌을 허용한다.

- 서로 다른 레플리카에 서로 다른 값 기록 가능
- 내부적으로 버전 정보를 유지
- 최종적으로 하나의 상태로 수렴

기본적인 충돌 해결 방식은  
Last Write Wins 모델이며,  
필요 시 조건부 쓰기를 통해 충돌을 제어할 수 있다.

---

### 4. 장애 복구와 일관성

- HBase
  - 장애 시 WAL replay를 통해 데이터 복구
  - Region 재할당 후 정상 상태로 복귀
  - 복구 과정은 순차적이며 최종 일관성에 따름

- DynamoDB
  - 다중 AZ 복제 구조
  - 일부 노드 장애 시에도 읽기/쓰기 지속
  - 백그라운드 복제로 상태를 동기화

두 시스템 모두  
장애 상황에서 즉시 강한 일관성을 보장하기보다는  
서비스 지속성과 복구 이후 수렴을 선택한다.

---

### 5. 일관성 선택이 설계에 주는 영향

- HBase
  - 정확한 최신 데이터가 필요한 워크로드에 적합
  - 로그, 이력, 상태 관리 시스템에 유리
  - 설계 및 운영 복잡도 증가 가능

- DynamoDB
  - 대규모 트래픽과 높은 가용성이 필요한 서비스에 적합
  - 약간의 데이터 지연을 허용하는 시스템에 유리
  - 일관성은 비즈니스 요구에 따라 선택

---

### 6. 종합 비교

| 구분 | HBase | DynamoDB |
|---|---|---|
| 기본 일관성 모델 | Row 단위 Strong | Eventual |
| 글로벌 일관성 | Eventual | Eventual |
| 강한 일관성 옵션 | 기본 제공 | 선택적 제공 |
| 쓰기 충돌 처리 | 서버 직렬화 | 충돌 허용 후 수렴 |
| 가용성 우선순위 | 중간 | 매우 높음 |
| 설계 철학 | 정확성 중심 | 가용성 중심 |

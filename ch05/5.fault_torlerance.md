# 목차

- [5.5 키-값 저장소의 장애 허용성과 장애 식별](#55-키-값-저장소의-장애-허용성과-장애-식별)
- [5.5.1 일시적 장애 관리](#55-1-일시적-장애-관리)
  - [Hinted Handoff](#hinted-handoff)
  - [개념](#개념)
  - [동작 방식](#동작-방식)
  - [장점](#장점)
  - [한계 및 주의사항](#한계-및-주의사항)
- [5.5.2 영구적 장애 관리](#55-2-영구적-장애-관리)
  - [Merkle Tree](#merkle-tree)
  - [개념 및 구조](#개념-및-구조)
  - [데이터 비교 및 복구 과정](#데이터-비교-및-복구-과정)
- [5.5.3 해시 링의 노드 구성과 장애 감지](#55-3-해시-링의-노드-구성과-장애-감지)
  - [가십 프로토콜(Gossip Protocol)](#가십-프로토콜gossip-protocol)

# 5.5 키-값 저장소의 장애 허용성과 장애 식별

분산 키-값 저장소는 일부 노드의 장애를 정상적인 상황으로 가정하고 설계된다.  
시스템은 장애 상황에서도 가용성과 일관성을 최대한 유지해야 하며,  
이를 위해 장애 유형에 따라 다른 복구 및 식별 전략을 사용한다.

---

## 5.5.1 일시적 장애 관리  
### Hinted Handoff

### 개념

일시적 장애는 네트워크 지연, 프로세스 재시작, 짧은 시간의 노드 다운 등  
비교적 짧은 시간 내에 복구 가능한 장애를 의미한다.

Hinted Handoff는 이러한 상황에서  
쓰기 요청을 실패로 처리하지 않고,  
다른 노드가 임시로 데이터를 대신 저장하는 기법이다.

---

### 동작 방식

- 특정 노드가 일시적으로 응답하지 않는 상태가 발생
- 해당 노드에 저장되어야 할 데이터를 다른 정상 노드에 저장
- 이때 원래 대상 노드를 식별하기 위한 힌트 정보(hint)를 함께 기록
- 장애 노드가 복구되면
  - 임시 저장된 데이터를 원래 노드로 전달
  - 전달 완료 후 힌트 데이터 삭제

---

### 장점

- 일시적인 장애 상황에서도 쓰기 가용성 유지
- 클라이언트 입장에서 실패율 감소
- 복구 이후 데이터 정합성 회복 가능

---

### 한계 및 주의사항

- 장애가 장기화될 경우 힌트 데이터가 누적될 수 있음
- 힌트를 보관하는 노드에 부하 집중 가능
- 영구적 장애에는 적합하지 않음
- 힌트 보관 기간 및 크기에 대한 정책 필요

---

## 5.5.2 영구적 장애 관리  
### Merkle Tree

### 개념

영구적 장애는 디스크 손상, 노드 폐기 등  
해당 노드가 다시 복구되지 않는 상황을 의미한다.

Merkle Tree는 이러한 상황에서  
노드 간 데이터 불일치를 효율적으로 탐지하고  
필요한 데이터만 동기화하기 위한 해시 기반 트리 구조이다.

---

### Merkle Tree 구조

- 전체 데이터 집합을 트리 구조로 표현
- 리프 노드는 개별 데이터 항목의 해시 값
- 부모 노드는 자식 노드 해시 값을 조합한 해시
- 루트 해시는 해당 노드가 보유한 전체 데이터 상태를 대표

---

### 데이터 비교 및 복구 과정

- 노드 간 루트 해시 값을 비교
- 루트 해시가 다르면 하위 트리로 이동하며 비교
- 불일치가 발생한 최소 데이터 범위 식별
- 해당 데이터만 네트워크를 통해 동기화

---

### 장점

- 전체 데이터를 비교할 필요 없이 차이점 탐지 가능
- 네트워크 트래픽 최소화
- 대규모 데이터셋에서도 확장 가능

---

### 한계

- 트리 유지 및 갱신에 따른 계산 비용 발생
- 데이터 변경 빈도가 높을수록 관리 비용 증가
- 구현 복잡도가 높음

---

## 5.5.3 해시 링의 노드 구성과 장애 감지  
### 가십 프로토콜(Gossip Protocol)

### 개념

가십 프로토콜은 분산 시스템에서  
노드 상태 정보를 전파하고 장애를 감지하기 위한 분산 통신 방식이다.

중앙 관리 노드 없이  
노드들이 서로 상태 정보를 교환하며  
클러스터 전체 상태를 점진적으로 공유한다.

---

### 동작 방식

- 각 노드는 주기적으로 임의의 다른 노드와 통신
- 자신이 알고 있는 노드 상태 정보를 교환
- 정보는 전염성 있게 클러스터 전체로 확산
- 일정 시간 동안 응답이 없는 노드는 의심 상태로 표시
- 반복적으로 실패가 감지되면 장애 노드로 판정

---

### 장점

- 중앙 집중식 관리 노드가 필요 없음
- 노드 수 증가에도 비교적 안정적인 확장성
- 부분 장애 상황에서도 클러스터 상태 유지 가능

---

### 한계

- 장애 감지까지 일정 시간 지연 발생
- 네트워크 분리 상황에서 오탐 가능성
- 최종 수렴(eventual convergence) 방식


## 목차

- [가상 노드와 일관된 해싱이 장애 문제를 해결하는 방식](#가상-노드와-일관된-해싱이-장애-문제를-해결하는-방식)
- [1. 기존 해싱 방식의 문제점](#1-기존-해싱-방식의-문제점)
  - [노드 장애 발생 시 문제](#노드-장애-발생-시-문제)
- [2. 일관된 해싱의 핵심 개념](#2-일관된-해싱의-핵심-개념)
- [3. 장애 발생 시 일관된 해싱의 동작 방식](#3-장애-발생-시-일관된-해싱의-동작-방식)
  - [노드 장애 발생](#노드-장애-발생)
  - [결과](#결과)
- [4. 일관된 해싱만으로는 부족한 점](#4-일관된-해싱만으로는-부족한-점)
- [5. 가상 노드(Virtual Node)의 역할](#5-가상-노드virtual-node의-역할)
- [6. 장애 발생 시 가상 노드의 효과](#6-장애-발생-시-가상-노드의-효과)
  - [장애 전](#장애-전)
  - [장애 발생 시](#장애-발생-시)
  - [결과](#결과-1)
- [7. 일관된 해싱 + 가상 노드 조합의 효과](#7-일관된-해싱--가상-노드-조합의-효과)
- [분산 저장소 아키텍처: Master-Slave와 Peer-to-Peer](#분산-저장소-아키텍처-master-slave와-peer-to-peer)
- [1. Master-Slave 구조](#1-master-slave-구조)
  - [1.1 개념](#11-개념)
  - [1.2 동작 방식](#12-동작-방식)
  - [1.3 장애 발생 시 동작](#13-장애-발생-시-동작)
    - [Master 장애](#master-장애)
    - [Slave 장애](#slave-장애)
  - [1.4 장점](#14-장점)
  - [1.5 단점](#15-단점)
  - [1.6 주요 활용 사례](#16-주요-활용-사례)
- [2. Peer-to-Peer 구조](#2-peer-to-peer-구조)
  - [2.1 개념](#21-개념)
  - [2.2 동작 방식](#22-동작-방식)
  - [2.3 장애 발생 시 동작](#23-장애-발생-시-동작)
    - [단일 노드 장애](#단일-노드-장애)
    - [다중 노드 장애](#다중-노드-장애)
  - [2.4 장점](#24-장점)
  - [2.5 단점](#25-단점)
  - [2.6 주요 활용 사례](#26-주요-활용-사례)
- [3. 장애 관점에서의 구조 비교](#3-장애-관점에서의-구조-비교)
  - [Master-Slave 구조](#master-slave-구조)
  - [Peer-to-Peer 구조](#peer-to-peer-구조)
- [4. 일관된 해싱 및 가상 노드와의 관계](#4-일관된-해싱-및-가상-노드와의-관계)

## 가상 노드와 일관된 해싱이 장애 문제를 해결하는 방식

분산 키-값 저장소에서 노드 장애는 빈번하게 발생할 수 있으며,
저장소 설계에서 가장 중요한 목표 중 하나는
장애 발생 시 데이터 이동과 서비스 영향을 최소화하는 것이다.

이를 해결하기 위해 널리 사용되는 기법이
일관된 해싱(Consistent Hashing)과 가상 노드(Virtual Node)이다.

---

## 1. 기존 해싱 방식의 문제점

단순 해싱 방식에서는 키와 노드를 다음과 같이 매핑한다.

- hash(key) % N (N = 전체 노드 수)

이 방식은 구현이 단순하지만,
노드 장애나 노드 추가·제거 시 치명적인 문제가 발생한다.

### 노드 장애 발생 시 문제

- 전체 노드 수 N이 변경됨
- 모든 키의 해시 결과가 변함
- 거의 모든 키가 다른 노드로 재배치됨
- 대량 데이터 이동 발생
- 캐시 무효화, 지연 시간 증가, 서비스 불안정 초래

즉, 하나의 노드 장애가 시스템 전체에 영향을 주는 구조이다.

---

## 2. 일관된 해싱의 핵심 개념

일관된 해싱은 키와 노드를 동일한 해시 공간(해시 링) 위에 배치한다.

- 해시 공간은 0부터 최대 해시 값까지의 원형 구조
- 키와 노드를 모두 해시 링 위의 한 점으로 표현
- 각 키는 시계 방향으로 가장 가까운 노드에 할당됨

이 구조의 핵심 특징은
노드 추가 또는 제거 시 영향을 받는 키의 범위가 매우 제한적이라는 점이다.

---

## 3. 장애 발생 시 일관된 해싱의 동작 방식

### 노드 장애 발생

1. 특정 노드가 장애로 인해 해시 링에서 제거됨
2. 해당 노드가 담당하던 키들만 재할당 대상이 됨
3. 각 키는 다음 시계 방향 노드로 이동
4. 나머지 노드와 키 매핑은 유지됨

### 결과

- 전체 키 중 일부만 이동
- 데이터 이동량 최소화
- 장애의 영향 범위 국소화
- 서비스 연속성 유지 가능

이로 인해 일관된 해싱은 대규모 분산 시스템에서 장애 대응에 매우 유리하다.

---

## 4. 일관된 해싱만으로는 부족한 점

일관된 해싱만 사용해도
노드 추가·제거로 인한 대규모 리밸런싱 문제는 해결된다.

그러나 다음과 같은 새로운 문제가 발생할 수 있다.

- 노드가 해시 링에 불균등하게 배치될 수 있음
- 특정 노드에 키가 몰리는 현상(부하 불균형)
- 장애 발생 시 일부 노드에 트래픽 집중 가능

이 문제를 해결하기 위해 등장한 개념이 가상 노드이다.

---

## 5. 가상 노드(Virtual Node)의 역할

가상 노드는
하나의 물리 노드를 해시 링 상에 여러 개의 노드로 표현하는 기법이다.

- 하나의 물리 노드는 여러 개의 가상 노드를 가짐
- 각 가상 노드는 서로 다른 해시 위치에 배치됨
- 실제 데이터는 해당 가상 노드가 가리키는 물리 노드에 저장됨

---

## 6. 장애 발생 시 가상 노드의 효과

### 장애 전

- 각 물리 노드는 여러 가상 노드를 통해 해시 공간 전반에 분산됨
- 키 분포가 고르게 유지됨

### 장애 발생 시

1. 장애가 발생한 물리 노드의 모든 가상 노드가 해시 링에서 제거됨
2. 각 가상 노드가 담당하던 키 범위가
   여러 다른 물리 노드로 나뉘어 이동
3. 특정 노드로 트래픽이 집중되지 않음

### 결과

- 데이터 재분배가 여러 노드로 분산
- 부하 집중 현상 완화
- 장애 복구 시에도 안정적인 재배치 가능

---

## 7. 일관된 해싱 + 가상 노드 조합의 효과

두 기법을 함께 사용하면 다음과 같은 이점이 있다.

- 장애 발생 시 이동되는 데이터 최소화
- 데이터 및 트래픽 분배의 균형 유지
- 노드 추가·제거 시 리밸런싱 비용 감소
- 대규모 분산 환경에서 높은 안정성 확보

이 조합은 Redis Cluster, Cassandra, DynamoDB 등
다수의 분산 저장소 시스템에서 핵심 설계 요소로 사용된다.

## 분산 저장소 아키텍처: Master-Slave와 Peer-to-Peer

분산 데이터 저장소에서는
노드 간 역할 분담 방식에 따라 전체 시스템의
가용성, 확장성, 장애 대응 방식이 크게 달라진다.

대표적인 구조는
Master-Slave 구조와 Peer-to-Peer 구조이며,
각각 서로 다른 장단점과 활용 시나리오를 가진다.

---

## 1. Master-Slave 구조

### 1.1 개념

Master-Slave 구조는
하나의 Master 노드가 데이터의 쓰기(write)를 담당하고,
여러 Slave(Replica) 노드가 읽기(read)를 담당하는 구조이다.

- Master: 쓰기 처리 및 데이터의 기준(Source of Truth)
- Slave: Master로부터 데이터를 복제 받아 읽기 요청 처리

즉, 쓰기와 읽기를 역할로 명확히 분리한 구조이다.

---

### 1.2 동작 방식

- 모든 쓰기 요청은 Master 노드로 전달된다
- Master는 데이터를 갱신한 후 Slave 노드로 변경 내용을 전파한다
- 읽기 요청은 Master 또는 Slave에서 처리될 수 있다
- Slave는 일반적으로 읽기 전용이다

---

### 1.3 장애 발생 시 동작

#### Master 장애

- 쓰기 요청 처리 불가
- Slave에 데이터가 존재하더라도 쓰기는 중단됨
- 장애 해결 방법
  - 수동 또는 자동 Failover
  - Slave 중 하나를 새로운 Master로 승격

#### Slave 장애

- 일부 읽기 요청만 영향을 받음
- 전체 시스템 가용성에는 비교적 큰 영향 없음

---

### 1.4 장점

- 구조가 단순하고 이해하기 쉬움
- 데이터 정합성 관리가 비교적 용이
- 트랜잭션 및 일관성 보장에 유리

---

### 1.5 단점

- Master가 단일 장애 지점(SPOF)이 될 수 있음
- 쓰기 성능이 Master 성능에 의존
- Master 장애 시 복구 과정이 복잡
- 대규모 쓰기 트래픽 처리에 한계

---

### 1.6 주요 활용 사례

- 전통적인 RDBMS 복제 구조
- 읽기 트래픽이 쓰기보다 훨씬 많은 서비스
- 강한 일관성이 중요한 시스템

---

## 2. Peer-to-Peer 구조

### 2.1 개념

Peer-to-Peer 구조는
모든 노드가 동등한 역할을 수행하는 분산 구조이다.

- 특정 Master 노드가 존재하지 않음
- 모든 노드는 읽기와 쓰기를 모두 처리 가능
- 데이터는 여러 노드에 분산 저장됨

각 노드는 독립적이며, 전체 시스템은 협력적으로 동작한다.

---

### 2.2 동작 방식

- 클라이언트는 임의의 노드로 요청을 보낼 수 있다
- 노드는 키에 따라 데이터를 직접 저장하거나
  적절한 다른 노드로 요청을 전달한다
- 데이터는 여러 노드에 복제되어 저장될 수 있다

---

### 2.3 장애 발생 시 동작

#### 단일 노드 장애

- 장애 노드가 담당하던 데이터 요청은
  다른 노드에서 처리
- 시스템 전체는 계속 동작 가능

#### 다중 노드 장애

- 복제 개수(replication factor)에 따라
- 일부 데이터 접근 불가능 가능성
- 일관성 모델에 따라 응답 방식 달라짐

---

### 2.4 장점

- 단일 장애 지점이 존재하지 않음
- 높은 가용성과 확장성
- 노드 추가·제거가 비교적 자유로움
- 대규모 트래픽 처리에 유리

---

### 2.5 단점

- 구조가 복잡하고 구현 난이도 높음
- 데이터 정합성 관리가 어려움
- 강한 일관성을 유지하기 어렵거나 비용이 큼
- 운영 및 장애 분석 난이도 증가

---

### 2.6 주요 활용 사례

- 글로벌 분산 시스템
- 대규모 분산 키-값 저장소
- 고가용성이 최우선인 서비스

---

## 3. 장애 관점에서의 구조 비교

### Master-Slave 구조

- 장애 대응 방식: Master 승격(Failover)
- 영향 범위: Master 장애 시 전체 쓰기 중단
- 핵심 리스크: 단일 장애 지점(SPOF)

### Peer-to-Peer 구조

- 장애 대응 방식: 다른 노드가 자동 처리
- 영향 범위: 일부 데이터 접근만 제한될 수 있음
- 핵심 리스크: 데이터 정합성 및 운영 복잡도

---

## 4. 일관된 해싱 및 가상 노드와의 관계

- Master-Slave 구조
  - 보통 Master가 파티션을 관리
  - 노드 교체 시 재배치 부담이 큼

- Peer-to-Peer 구조
  - 일관된 해싱을 통해 키와 노드를 매핑
  - 가상 노드를 통해 부하 분산
  - 장애 발생 시 이동되는 데이터 최소화

특히 Peer-to-Peer 구조는
일관된 해싱과 가상 노드를 결합했을 때
장애 대응과 확장성 측면에서 큰 장점을 가진다.
  - 가상 노드를 통해 부하 분산
  - 장애 발생 시 이동되는 데이터 최소화

특히 Peer-to-Peer 구조는
일관된 해싱과 가상 노드를 결합했을 때
장애 대응과 확장성 측면에서 큰 장점을 가진다.